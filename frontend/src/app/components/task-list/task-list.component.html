<div class="task-list-container">
  <div class="header">
    <h2>My Tasks</h2>
    <button class="logout-btn" (click)="logout()">Logout</button>
  </div>

  <app-priority-filter (prioritySelected)="applyFilter($event)"> </app-priority-filter>

  <button class="create-btn" (click)="openCreateForm()">Add +</button>

  <app-create-task *ngIf="creating" (create)="handleCreate($event)" (cancel)="creating = false">
  </app-create-task>

  <div class="error-message" *ngIf="errorMessage">
    {{ errorMessage }}
  </div>

  <table class="task-table">
    <thead>
      <tr>
        <th>
          <input type="checkbox" (change)="toggleSelectAll($event)" />
        </th>
        <th>Title</th>
        <th>Description</th>
        <th>Status</th>
        <th>Priority</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let task of tasks" [ngClass]="{ 'selected-row': selectedTasks.has(task._id!) }">
        <td>
          <input
            type="checkbox"
            [checked]="task._id && selectedTasks.has(task._id)"
            (change)="task._id && toggleSelection(task._id, $event)"
          />
        </td>
        <td>{{ task.title }}</td>
        <td>{{ task.description || '-' }}</td>
        <td>
          <span class="status-badge" [ngClass]="'status-' + task.status.toLowerCase()">
            {{ task.status }}
          </span>
        </td>
        <td>
          <span class="priority-badge" [ngClass]="'priority-' + task.priority.toLowerCase()">
            {{ task.priority }}
          </span>
        </td>
        <td class="actions">
          <button class="edit-btn" (click)="editTask(task._id!)">Edit</button>
          <button class="delete-btn" (click)="deleteTask(task._id!)">Delete</button>
        </td>
      </tr>
      <tr *ngIf="tasks.length === 0">
        <td colspan="5" class="no-tasks">No tasks found. Create your first task!</td>
      </tr>
    </tbody>
  </table>
  <div class="bulk-actions" *ngIf="selectedTasks.size > 0">
    <button class="btn-bulk" (click)="openBulkEdit()">Edit selected</button>
    <button class="btn-delete" (click)="bulkDelete()">Delete Selected</button>
  </div>
  <app-bulk-edit
    [open]="bulkEditOpen"
    (apply)="applyBulkEdit($event)"
    (close)="bulkEditOpen = false"
  >
  </app-bulk-edit>
</div>
